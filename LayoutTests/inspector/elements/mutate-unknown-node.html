<html>
<head>
<script src="../../http/tests/inspector/inspector-test.js"></script>
<script src="../../http/tests/inspector/elements-test.js"></script>
<script>

function appendChild()
{
    var hidden = document.getElementById("hidden");
    var child = document.createElement("div");
    child.setAttribute("id", "appended");
    hidden.appendChild(child);
}

function removeChild()
{
    var child = document.getElementById("appended");
    child.parentNode.removeChild(child);
}

function modifyAttribute()
{
    var hidden = document.getElementById("hidden");
    hidden.setAttribute("foo", "bar");
}

function test()
{
    function listener(type, event)
    {
        InspectorTest.addResult("DOMAgent event fired. Should only happen once for output node: " + type + " " + event.target.nodeName + "#" + event.target.getAttribute("id"));
    }

    WebInspector.domAgent.requestDocument(step0.bind(this));

    function step0(doc)
    {
        doc.addEventListener("DOMAttrModified", listener.bind(this, "DOMAttrModified"));
        doc.addEventListener("DOMCharacterDataModified", listener.bind(this, "DOMCharacterDataModified"));
        doc.addEventListener("DOMNodeInserted", listener.bind(this, "DOMNodeInserted"));
        doc.addEventListener("DOMNodeRemoved", listener.bind(this, "DOMNodeRemoved"));
        InspectorTest.evaluateInPage("appendChild()", step1);
    }

    function step1()
    {
        InspectorTest.addResult("Appended");
        InspectorTest.evaluateInPage("removeChild()", step2);
    }

    function step2()
    {
        InspectorTest.addResult("Removed");
        InspectorTest.evaluateInPage("modifyAttribute()", step3);
    }

    function step3()
    {
        InspectorTest.addResult("Attribute modified");
        InspectorTest.evaluateInPage("true", step4);
    }

    function step4()
    {
        InspectorTest.addResult("========= Result DOMAgent tree ========");
        InspectorTest.dumpDOMAgentTree();

        InspectorTest.completeTest();
    }
}

</script>
</head>

<body onload="runTest()">
<p>
Tests that elements panel does not receive events upon changes to the undiscovered nodes.
</p>

<div>
<div id="hidden">
</div>
</div>

</body>
</html>
